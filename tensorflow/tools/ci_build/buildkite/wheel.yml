steps:
  - label: Run in Docker
    agents:
      queue: "docker"
    commands:
      - "bazel version"
      - "bazel version"
      - "tensorflow/tools/ci_build/builds/configured GPU bazel build -c opt --copt=-mavx --config=cuda --cxxopt='-D_GLIBCXX_USE_CXX11_ABI=0' tensorflow/tools/pip_package:build_pip_package"
      - "bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/pip"
    plugins:
      - docker#v3.3.0:
          image: "tensorflow/tensorflow:devel-gpu"
          always-pull: true
          runtime: nvidia
          propagate-environment: true
          volumes:
            - "/etc/group:/etc/group:ro"
            - "/etc/passwd:/etc/passwd:ro"
            - "/opt:/opt:ro"
