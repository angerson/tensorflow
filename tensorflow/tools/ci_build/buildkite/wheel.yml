steps:
  - label: Run in Docker
    agents:
      queue: "docker"
    commands:
      - "whoami"
      - "yes '' | ./configure"
      - "bazel build -c opt //tensorflow/tools/pip_package:build_pip_package"
      - "bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/pip"
    plugins:
      - docker#v3.3.0:
          network: "host"
          volumes:
            - "/etc/group:/etc/group:ro"
            - "/etc/passwd:/etc/passwd:ro"
            - "/opt:/opt:ro"
            - "/var/lib/gitmirrors:/var/lib/gitmirrors:ro"
            - "/var/run/docker.sock:/var/run/docker.sock"
          image: "tensorflow/tensorflow:devel-py3"
          privileged: true
          propagate-uid-gid: true
          always-pull: true
          propagate-environment: true
